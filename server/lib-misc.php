<?php

mb_internal_encoding('UTF-8');
date_default_timezone_set(isset($__context['timezone']) ? $__context['timezone'] : 'Asia/Taipei');

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///// DEBUGGING /////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

if(!isset($__app) || !isset($__app['is_debugging']) || $__app['is_debugging'] == true)  {
//	echo "<pre>report all errors</pre>";
	ini_set('display_errors', 'On');
	error_reporting(-1);
}

function ___($obj, $return = false, $table = false, $caption = 'data table') {
	$string = '';
	if($table) {
		if(!is_array($obj)) {
			$string = '<pre>not a table</pre>';
		}
		else if(count($obj) < 1) {
			$string = '<pre>table is empty</pre>';
		}
		else {
			$head = '<th><pre>#</pre></th>';
			foreach(reset($obj) as $k => $v) {
				$head .= "<th><pre>$k</pre></th>";
			}
			$head = "<tr>$head</tr>";
			$body = '';
			$counter = 0;
			foreach($obj as $row) {
				$row_html = "<th><pre>$counter</pre></th>";
				foreach($row as $col) {
					$row_html .= "<td><pre>$col</pre></td>";
				}
				$body .= "<tr>$row_html</tr>";
				$counter++;
			}
			$string = "<table><caption><pre>$caption</pre></caption><thead>$head</thead><tbody>$body></tbody></table>";
		}
	}
	else {
		if(is_string($obj))
			$string = $obj;
		else if(is_bool($obj))
			$string = ($obj ? 'true' : 'false');
		else
			$string = print_r($obj, true);
		
		$string = htmlspecialchars($string);
		
		if(strpos($string, '///') !== false) {
			$temp = explode('///', $string);
			$string = '<tr><td><pre>' . implode('</pre></td><td><pre>', $temp) . '</pre></td></tr>' . "\n";
		}
		else
			$string = '<pre>' . $string . '</pre>' . "\n";
	}

	if($return)
		return $string;
	else {
		echo $string;
		@ob_flush();
		@flush();
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///// ARRAY /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function select($key, $array) {
	$result = array();
	foreach($array as $item) {
		$result[] = $item[$key];
	}
	return $result;
}

function promote($key, $array) {
	$result = array();
	foreach($array as $item) {
		if(!isset($item[$key]))
			continue;
			
		$value = $item[$key];
		unset($item[$key]);
		if(count($item) == 1) {
			$item = array_pop($item);
		}
		$result[$value] = $item;
	}
	return $result;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///// SERIALIZATION /////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function encode($obj) {
	return base64_encode(serialize($obj));
}

function decode($string) {
	return unserialize(trim(base64_decode($string)));
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///// STRING VALIDATION /////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function _str_is_latin($string) {
//	return (preg_match('/[^A-Za-z\x{00C0}-\x{024F}\x{0400}-\x{A69F}]/', $string) == 0);
	return (preg_match('/[^A-Za-z\x{00C0}-\x{024F}]/u', $string) == 0);
}
function _str_is_literal_numerical($string) {
	return !preg_match('/[^a-zA-Z0-9]/i', $string);
}
function _str_is_literal($string) {
	return !preg_match('/[^a-zA-Z_]/i', $string);
}
function _str_is_pos_int($string) {
	return !preg_match('/[^0-9]/i', $string);
}
function _str_is_date($string) {
	return !preg_match('/[0-9]+\/[0-9]+\/[0-9]+/i', $string);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///// NATURAL LANGUAGE //////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function to_plural($singular) {
	if(substr($singular, -1) == 'y') {
		return substr($singular, 0, strlen($singular) - 1) . 'ies';
	}
	else
		return $singular . 's';
}

function to_singular($plural) {
	if(substr($plural, -3) == 'ies')
		return substr($plural, 0, strlen($plural) - 3) . 'y';
	else
		return substr($plural, 0, strlen($plural) - 1);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///// LIBRARIES /////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//include_once('lib-db.php');

?>